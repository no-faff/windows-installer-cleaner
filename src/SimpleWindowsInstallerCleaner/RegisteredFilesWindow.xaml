<Window x:Class="SimpleWindowsInstallerCleaner.RegisteredFilesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Registered files"
        Width="800" Height="550"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterOwner"
        Background="#F5F5F5">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Products header -->
            <RowDefinition Height="6"/>
            <RowDefinition Height="*"/>    <!-- Products list -->
            <RowDefinition Height="10"/>   <!-- spacer -->
            <RowDefinition Height="*"/>    <!-- Patches + Details -->
            <RowDefinition Height="10"/>   <!-- spacer -->
            <RowDefinition Height="Auto"/> <!-- summary line -->
            <RowDefinition Height="12"/>   <!-- spacer -->
            <RowDefinition Height="Auto"/> <!-- close button -->
        </Grid.RowDefinitions>

        <!-- ── Products header ────────────────────────────────── -->
        <TextBlock Grid.Row="0"
                   Text="Products"
                   FontSize="12"
                   FontWeight="SemiBold"
                   Foreground="#444"/>

        <!-- ── Products list ──────────────────────────────────── -->
        <Border Grid.Row="2"
                BorderBrush="#D0D0D0"
                BorderThickness="1"
                Background="White">
            <ListView ItemsSource="{Binding Products}"
                      SelectedItem="{Binding SelectedProduct, Mode=TwoWay}"
                      BorderThickness="0"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Product name" Width="250">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding ProductName}"
                                               FontSize="12"
                                               Foreground="#222"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding ProductName}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="File" Width="140">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding FileName}"
                                               FontSize="12"
                                               Foreground="#555"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding FullPath}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Size" Width="80">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding SizeDisplay}"
                                               FontSize="12"
                                               Foreground="#555"
                                               TextAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Patches" Width="60">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding PatchCount}"
                                               FontSize="12"
                                               Foreground="#555"
                                               TextAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>
        </Border>

        <!-- ── Bottom half: Patches (left) + Product details (right) ── -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="220"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Patches panel -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="6"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                           Text="Patches"
                           FontSize="12"
                           FontWeight="SemiBold"
                           Foreground="#444"/>

                <Border Grid.Row="2"
                        BorderBrush="#D0D0D0"
                        BorderThickness="1"
                        Background="White">
                    <Grid>
                        <!-- No patches placeholder -->
                        <TextBlock Text="(none)"
                                   FontSize="12"
                                   Foreground="#AAA"
                                   FontStyle="Italic"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedProduct}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <ListBox ItemsSource="{Binding SelectedPatches}"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 Padding="8,6"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListBox.Style>
                                <Style TargetType="ListBox">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedProduct}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ListBox.Style>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,2">
                                        <TextBlock Text="{Binding FileName}"
                                                   FontSize="12"
                                                   Foreground="#222"
                                                   TextTrimming="CharacterEllipsis"
                                                   ToolTip="{Binding FullPath}"/>
                                        <TextBlock Text="{Binding SizeDisplay}"
                                                   FontSize="11"
                                                   Foreground="#888"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>
            </Grid>

            <!-- Product details panel -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="6"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                           Text="Product details"
                           FontSize="12"
                           FontWeight="SemiBold"
                           Foreground="#444"/>

                <Border Grid.Row="2"
                        BorderBrush="#D0D0D0"
                        BorderThickness="1"
                        Background="White"
                        Padding="12,10">
                    <Grid>

                        <!-- Placeholder: nothing selected -->
                        <TextBlock Text="Select a product to view details."
                                   FontSize="12"
                                   Foreground="#888"
                                   FontStyle="Italic"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextWrapping="Wrap">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasSelection}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Placeholder: no metadata -->
                        <TextBlock Text="No metadata available."
                                   FontSize="12"
                                   Foreground="#AAA"
                                   FontStyle="Italic"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   Visibility="{Binding ShowNoMetadata, Converter={StaticResource BoolToVis}}"/>

                        <!-- Details grid -->
                        <Grid Visibility="{Binding ShowDetails, Converter={StaticResource BoolToVis}}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="6"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="6"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="6"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="6"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="6"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Author" FontSize="11" Foreground="#888"/>
                            <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding SelectedDetails.Author}" FontSize="12" Foreground="#222" TextWrapping="Wrap"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Title" FontSize="11" Foreground="#888"/>
                            <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding SelectedDetails.Title}" FontSize="12" Foreground="#222" TextWrapping="Wrap"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Subject" FontSize="11" Foreground="#888"/>
                            <TextBlock Grid.Row="4" Grid.Column="2" Text="{Binding SelectedDetails.Subject}" FontSize="12" Foreground="#222" TextWrapping="Wrap"/>

                            <TextBlock Grid.Row="6" Grid.Column="0" Text="Signature" FontSize="11" Foreground="#888"/>
                            <TextBlock Grid.Row="6" Grid.Column="2" Text="{Binding SelectedDetails.DigitalSignature}" FontSize="12" Foreground="#222" TextWrapping="Wrap"/>

                            <TextBlock Grid.Row="8" Grid.Column="0" Text="Size" FontSize="11" Foreground="#888"/>
                            <TextBlock Grid.Row="8" Grid.Column="2" Text="{Binding SelectedProduct.SizeDisplay}" FontSize="12" Foreground="#222"/>

                            <TextBlock Grid.Row="10" Grid.Column="0" Text="Comment" FontSize="11" Foreground="#888"/>
                            <TextBlock Grid.Row="10" Grid.Column="2" Text="{Binding SelectedDetails.Comments}" FontSize="12" Foreground="#222" TextWrapping="Wrap"/>
                        </Grid>

                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- ── Summary line ────────────────────────────────────── -->
        <TextBlock Grid.Row="6"
                   Text="{Binding Summary}"
                   FontSize="12"
                   Foreground="#555"/>

        <!-- ── Close button ─────────────────────────────────────── -->
        <Button Grid.Row="8"
                Content="Close"
                IsCancel="True"
                HorizontalAlignment="Right"
                Padding="20,7"
                FontSize="13"/>

    </Grid>
</Window>
