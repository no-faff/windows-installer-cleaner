<Window x:Class="SimpleWindowsInstallerCleaner.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Windows installer cleaner - v0.1.0-alpha"
        Width="720" Height="480"
        MinWidth="520" MinHeight="400"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource Base100}">

    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding ScanCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Grid.RowSpan="2" Margin="24,0,24,48" VerticalAlignment="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="16"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="12"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- ── Context: scan results ──────────────────────── -->
            <StackPanel Grid.Row="0">

                <!-- Pending reboot warning -->
                <TextBlock Margin="0,0,0,18"
                           Visibility="{Binding HasPendingReboot, Converter={StaticResource BoolToVis}}">
                    <Run Text="&#x26A0;" Foreground="#f59e0b"/>
                    <Run Text=" Windows has pending updates. Restart before moving or deleting files."
                         Foreground="#cbd5e1"/>
                </TextBlock>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="4"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Still used -->
                    <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"
                               Foreground="#94a3b8" FontSize="14">
                        <Run Text="{Binding RegisteredFileCount, Mode=OneWay}"/>
                        <Run Text=" files still used"/>
                    </TextBlock>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding RegisteredSizeDisplay}"
                               Foreground="#cbd5e1" FontSize="12"
                               VerticalAlignment="Center" MinWidth="72" TextAlignment="Right"
                               Margin="12,0"/>
                    <Button Grid.Row="0" Grid.Column="2" Style="{StaticResource LinkButton}"
                            Content="details..." Command="{Binding OpenRegisteredDetailsCommand}"
                            VerticalAlignment="Center" Margin="12,0,0,0"/>

                    <!-- Excluded by filters -->
                    <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center"
                               Foreground="#94a3b8" FontSize="14">
                        <Run Text="{Binding ExcludedFileCount, Mode=OneWay}"/>
                        <Run Text=" files excluded by filters"/>
                    </TextBlock>
                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding ExcludedSizeDisplay}"
                               Foreground="#94a3b8" FontSize="12"
                               VerticalAlignment="Center" MinWidth="72" TextAlignment="Right"
                               Margin="12,0"/>
                </Grid>

            </StackPanel>

            <!-- ── Separator ────────────────────────────────────── -->
            <Border Grid.Row="2" BorderBrush="#334155" BorderThickness="0,1,0,0"/>

            <!-- ── Action zone: orphaned + move/delete ──────────── -->
            <Grid Grid.Row="4">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="16"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Orphaned -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" VerticalAlignment="Center">
                        <Run Text="{Binding OrphanedFileCount, Mode=OneWay}" Foreground="#cbd5e1"
                             FontSize="15"/>
                        <Run Text=" files orphaned" Foreground="#cbd5e1"
                             FontSize="14"/>
                    </TextBlock>
                    <TextBlock Grid.Column="1" Text="{Binding OrphanedSizeDisplay}"
                               Foreground="#cbd5e1" FontSize="12"
                               VerticalAlignment="Center" MinWidth="72" TextAlignment="Right"
                               Margin="12,0"/>
                    <Button Grid.Column="2" Style="{StaticResource LinkButton}"
                            Content="details..." Command="{Binding OpenOrphanedDetailsCommand}"
                            VerticalAlignment="Center" Margin="12,0,0,0"/>
                </Grid>

                <!-- Move location label -->
                <TextBlock Grid.Row="2" Text="MOVE LOCATION"
                           Foreground="#94a3b8" FontSize="14"/>

                <!-- Move destination -->
                <Grid Grid.Row="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0">
                        <TextBox Style="{StaticResource PillTextBox}"
                                 Text="{Binding MoveDestination, Mode=OneWay}"
                                 IsReadOnly="True"/>
                        <TextBlock Text="Move destination..."
                                   Foreground="#64748b" FontSize="12" FontStyle="Italic"
                                   Padding="16,0" VerticalAlignment="Center"
                                   IsHitTestVisible="False">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding MoveDestination}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>

                    <Button Grid.Column="2" Style="{StaticResource PrimaryPill}"
                            Content="Browse..." Command="{Binding BrowseDestinationCommand}"/>
                </Grid>

                <!-- Buttons row -->
                <DockPanel Grid.Row="6">
                    <Button DockPanel.Dock="Right" Style="{StaticResource AccentPill}"
                            Content="Move" Command="{Binding MoveAllCommand}"/>

                    <Button DockPanel.Dock="Right" Style="{StaticResource PrimaryPill}"
                            Content="Delete" Command="{Binding DeleteAllCommand}"
                            Margin="0,0,8,0"/>

                    <TextBlock DockPanel.Dock="Left" Text="{Binding OperationProgress}"
                               VerticalAlignment="Center" Foreground="#94a3b8"
                               FontSize="12"
                               TextTrimming="CharacterEllipsis"/>
                </DockPanel>
            </Grid>

        </Grid>

        <!-- ── Bottom nav ────────────────────────────────────── -->
        <DockPanel Grid.Row="2" LastChildFill="False" Margin="24,8,24,8">
            <Button DockPanel.Dock="Left" Style="{StaticResource GhostPill}"
                    Content="Settings" Command="{Binding OpenSettingsCommand}"/>
            <Button DockPanel.Dock="Left" Style="{StaticResource GhostPill}"
                    Content="Refresh" Command="{Binding RefreshCommand}" Margin="8,0,0,0"/>
            <Button DockPanel.Dock="Left" Style="{StaticResource GhostPill}"
                    Content="About" Command="{Binding ShowAboutCommand}" Margin="8,0,0,0"/>
            <Button DockPanel.Dock="Right" Style="{StaticResource GhostPill}"
                    Content="Donate" Command="{Binding DonateCommand}"/>
        </DockPanel>

        <!-- ── Scanning overlay ──────────────────────────────────── -->
        <Grid Grid.RowSpan="3" Visibility="{Binding IsScanning, Converter={StaticResource BoolToVis}}">
            <Rectangle Fill="{StaticResource Overlay}"/>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="240" Height="8" Margin="0,0,0,12"/>
                <TextBlock Text="{Binding ScanProgress}" Foreground="#f8fafc"
                           FontSize="14" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- ── Operating overlay ─────────────────────────────────── -->
        <Grid Grid.RowSpan="3" Visibility="{Binding IsOperating, Converter={StaticResource BoolToVis}}">
            <Rectangle Fill="{StaticResource Overlay}"/>
            <Border Background="{StaticResource Base200}" CornerRadius="20"
                    Padding="28,22" MinWidth="260"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="{Binding OperationProgress}" Foreground="#f8fafc"
                               FontSize="14" FontWeight="SemiBold"
                               HorizontalAlignment="Center" Margin="0,0,0,14"/>
                    <ProgressBar Value="{Binding OperationProgressPercent}"
                                 Minimum="0" Maximum="100"
                                 Width="200" Height="8" Margin="0,0,0,8"/>
                    <DockPanel Margin="0,0,0,2">
                        <TextBlock DockPanel.Dock="Right" Foreground="#64748b" FontSize="11">
                            <Run Text="{Binding OperationProgressPercent, Mode=OneWay, StringFormat='{}{0:F0}%'}"/>
                        </TextBlock>
                        <TextBlock Foreground="#64748b" FontSize="11">
                            <Run Text="{Binding OperationCurrentFile, Mode=OneWay}"/>
                            <Run Text=" of "/>
                            <Run Text="{Binding OperationTotalFiles, Mode=OneWay}"/>
                            <Run Text=" files"/>
                        </TextBlock>
                    </DockPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
