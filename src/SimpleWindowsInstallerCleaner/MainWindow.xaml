<Window x:Class="SimpleWindowsInstallerCleaner.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:SimpleWindowsInstallerCleaner.Controls"
        Title="Simple Windows installer cleaner — v0.1.0-alpha"
        Width="720" Height="400"
        MinWidth="520" MinHeight="360"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="False"
        Background="{DynamicResource WindowBackground}">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      ResizeBorderThickness="6"
                      GlassFrameThickness="0"
                      CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding ScanCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- title bar -->
            <RowDefinition Height="*"/>     <!-- content -->
        </Grid.RowDefinitions>

        <!-- ── Custom title bar ────────────────────────────────────── -->
        <controls:TitleBar Grid.Row="0"
                           WindowTitle="Simple Windows installer cleaner"
                           ShowMaximise="False"/>

        <!-- ── Main content ───────────────────────────────────────── -->
        <Grid Grid.Row="1" Margin="{StaticResource WindowPadding}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>    <!-- scan results card -->
                <RowDefinition Height="12"/>   <!-- spacer -->
                <RowDefinition Height="Auto"/> <!-- actions card -->
                <RowDefinition Height="16"/>   <!-- spacer -->
                <RowDefinition Height="Auto"/> <!-- bottom nav -->
            </Grid.RowDefinitions>

            <!-- ── Scan results card ─────────────────────────────── -->
            <Border Grid.Row="0"
                    Background="{DynamicResource CardBackground}"
                    BorderBrush="{DynamicResource CardBorder}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource CardRadius}"
                    Padding="{StaticResource CardPadding}"
                    Effect="{DynamicResource CardShadow}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- warning banner -->
                        <RowDefinition Height="*"/>    <!-- summary lines -->
                    </Grid.RowDefinitions>

                    <!-- Pending reboot warning (inside card) -->
                    <Border Grid.Row="0"
                            Background="{DynamicResource WarningBackground}"
                            BorderBrush="{DynamicResource WarningBorder}"
                            BorderThickness="1"
                            CornerRadius="6"
                            Padding="12,8"
                            Margin="0,0,0,16"
                            Visibility="{Binding HasPendingReboot, Converter={StaticResource BoolToVis}}">
                        <TextBlock Foreground="{DynamicResource WarningText}"
                                   FontFamily="{StaticResource AppFont}"
                                   FontSize="{StaticResource SmallSize}"
                                   TextWrapping="Wrap">
                            <Run Text="⚠" Foreground="{DynamicResource AccentWarning}"/>
                            <Run Text="  Windows has pending updates. Restart before moving or deleting installer files."/>
                        </TextBlock>
                    </Border>

                    <!-- Summary lines -->
                    <StackPanel Grid.Row="1" VerticalAlignment="Center">

                        <!-- Still used -->
                        <DockPanel Margin="0,0,0,10">
                            <Button DockPanel.Dock="Right"
                                    Style="{DynamicResource LinkButton}"
                                    Content="details..."
                                    Command="{Binding OpenRegisteredDetailsCommand}"
                                    VerticalAlignment="Top"
                                    Margin="12,0,0,0"/>
                            <TextBlock DockPanel.Dock="Right"
                                       Text="{Binding RegisteredSizeDisplay}"
                                       Foreground="{DynamicResource TextTertiary}"
                                       FontFamily="{StaticResource AppFont}"
                                       FontSize="{StaticResource BodySize}"
                                       VerticalAlignment="Top"
                                       MinWidth="72"
                                       TextAlignment="Right"/>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                                <TextBlock Text="●"
                                           Foreground="{DynamicResource AccentPrimary}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource BodySize}"
                                           Margin="0,1,8,0"/>
                                <TextBlock Text="{Binding RegisteredFileCount}"
                                           Foreground="{DynamicResource TextPrimary}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource SubheadingSize}"
                                           FontWeight="SemiBold"/>
                                <TextBlock Text=" files still used"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource BodySize}"
                                           VerticalAlignment="Bottom"
                                           Margin="4,0,0,1"/>
                            </StackPanel>
                        </DockPanel>

                        <!-- Excluded by filters -->
                        <DockPanel Margin="0,0,0,10"
                                   Visibility="{Binding HasExcludedFiles, Converter={StaticResource BoolToVis}}">
                            <Button DockPanel.Dock="Right"
                                    Style="{DynamicResource LinkButton}"
                                    Content="details..."
                                    Command="{Binding OpenOrphanedDetailsCommand}"
                                    VerticalAlignment="Top"
                                    Margin="12,0,0,0"/>
                            <TextBlock DockPanel.Dock="Right"
                                       Text="{Binding ExcludedSizeDisplay}"
                                       Foreground="{DynamicResource TextTertiary}"
                                       FontFamily="{StaticResource AppFont}"
                                       FontSize="{StaticResource BodySize}"
                                       VerticalAlignment="Top"
                                       MinWidth="72"
                                       TextAlignment="Right"/>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                                <TextBlock Text="●"
                                           Foreground="{DynamicResource TextTertiary}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource BodySize}"
                                           Margin="0,1,8,0"/>
                                <TextBlock Text="{Binding ExcludedFileCount}"
                                           Foreground="{DynamicResource TextPrimary}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource SubheadingSize}"
                                           FontWeight="SemiBold"/>
                                <TextBlock Foreground="{DynamicResource TextSecondary}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource BodySize}"
                                           VerticalAlignment="Bottom"
                                           Margin="4,0,0,1">
                                    <Run Text=" files excluded ("/>
                                    <Run Text="{Binding ExcludedFilterDisplay, Mode=OneWay}"/>
                                    <Run Text=")"/>
                                </TextBlock>
                            </StackPanel>
                        </DockPanel>

                        <!-- Orphaned -->
                        <DockPanel>
                            <Button DockPanel.Dock="Right"
                                    Style="{DynamicResource LinkButton}"
                                    Content="details..."
                                    Command="{Binding OpenOrphanedDetailsCommand}"
                                    VerticalAlignment="Top"
                                    Margin="12,0,0,0"/>
                            <TextBlock DockPanel.Dock="Right"
                                       Text="{Binding OrphanedSizeDisplay}"
                                       Foreground="{DynamicResource AccentDanger}"
                                       FontFamily="{StaticResource AppFont}"
                                       FontSize="{StaticResource BodySize}"
                                       VerticalAlignment="Top"
                                       MinWidth="72"
                                       TextAlignment="Right"/>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                                <TextBlock Text="●"
                                           Foreground="{DynamicResource AccentDanger}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource BodySize}"
                                           Margin="0,1,8,0"/>
                                <TextBlock Text="{Binding OrphanedFileCount}"
                                           Foreground="{DynamicResource AccentDanger}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource SubheadingSize}"
                                           FontWeight="SemiBold"/>
                                <TextBlock Text=" files orphaned"
                                           Foreground="{DynamicResource TextSecondary}"
                                           FontFamily="{StaticResource AppFont}"
                                           FontSize="{StaticResource BodySize}"
                                           VerticalAlignment="Bottom"
                                           Margin="4,0,0,1"/>
                            </StackPanel>
                        </DockPanel>

                    </StackPanel>
                </Grid>
            </Border>

            <!-- ── Actions card ──────────────────────────────────── -->
            <Border Grid.Row="2"
                    Background="{DynamicResource CardBackground}"
                    BorderBrush="{DynamicResource CardBorder}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource CardRadius}"
                    Padding="{StaticResource CardPadding}"
                    Effect="{DynamicResource CardShadow}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- destination row -->
                        <RowDefinition Height="12"/>   <!-- spacer -->
                        <RowDefinition Height="Auto"/> <!-- buttons row -->
                    </Grid.RowDefinitions>

                    <!-- Move destination -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Grid Grid.Column="0">
                            <TextBox Text="{Binding MoveDestination, Mode=OneWay}"
                                     IsReadOnly="True"
                                     Padding="8,6"
                                     FontFamily="{StaticResource AppFont}"
                                     FontSize="{StaticResource SmallSize}"
                                     VerticalContentAlignment="Center"/>
                            <TextBlock Text="Choose a destination folder..."
                                       Foreground="{DynamicResource TextTertiary}"
                                       FontFamily="{StaticResource AppFont}"
                                       FontSize="{StaticResource SmallSize}"
                                       FontStyle="Italic"
                                       Padding="10,6"
                                       VerticalAlignment="Center"
                                       IsHitTestVisible="False">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding MoveDestination}" Value="">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>

                        <Button Grid.Column="2"
                                Style="{DynamicResource SecondaryButton}"
                                Content="Browse..."
                                Command="{Binding BrowseDestinationCommand}"/>
                    </Grid>

                    <!-- Buttons row -->
                    <DockPanel Grid.Row="2">
                        <Button DockPanel.Dock="Right"
                                Style="{DynamicResource DangerButton}"
                                Content="Delete"
                                Command="{Binding DeleteAllCommand}"
                                Margin="8,0,0,0"/>

                        <Button DockPanel.Dock="Left"
                                Style="{DynamicResource PrimaryButton}"
                                Content="Move"
                                Command="{Binding MoveAllCommand}"/>

                        <TextBlock DockPanel.Dock="Left"
                                   Text="{Binding OperationProgress}"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource TextTertiary}"
                                   FontFamily="{StaticResource AppFont}"
                                   FontSize="{StaticResource SmallSize}"
                                   Margin="12,0,0,0"
                                   TextTrimming="CharacterEllipsis"/>
                    </DockPanel>
                </Grid>
            </Border>

            <!-- ── Bottom nav ────────────────────────────────────── -->
            <DockPanel Grid.Row="4" LastChildFill="False">
                <Button DockPanel.Dock="Left"
                        Style="{DynamicResource LinkButton}"
                        Content="⚙ Settings"
                        Command="{Binding OpenSettingsCommand}"/>

                <Button DockPanel.Dock="Left"
                        Style="{DynamicResource LinkButton}"
                        Content="↺ Refresh"
                        Command="{Binding RefreshCommand}"
                        Margin="16,0,0,0"/>

                <Button DockPanel.Dock="Left"
                        Style="{DynamicResource LinkButton}"
                        Content="ℹ About"
                        Command="{Binding ShowAboutCommand}"
                        Margin="16,0,0,0"/>

                <Button DockPanel.Dock="Right"
                        Style="{DynamicResource LinkButton}"
                        Content="♥ Donate"
                        Command="{Binding DonateCommand}"/>
            </DockPanel>

        </Grid>

        <!-- ── Scanning overlay ──────────────────────────────────── -->
        <Grid Grid.Row="0" Grid.RowSpan="2"
              Visibility="{Binding IsScanning, Converter={StaticResource BoolToVis}}">
            <Rectangle Fill="{DynamicResource ScanOverlayBackground}"/>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True"
                             Width="240" Height="3"
                             Margin="0,0,0,12"
                             Foreground="{DynamicResource AccentPrimary}"/>
                <TextBlock Text="{Binding ScanProgress}"
                           Foreground="{DynamicResource ScanOverlayText}"
                           FontFamily="{StaticResource AppFont}"
                           FontSize="{StaticResource BodySize}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- ── Operating overlay ─────────────────────────────────── -->
        <Grid Grid.Row="0" Grid.RowSpan="2"
              Visibility="{Binding IsOperating, Converter={StaticResource BoolToVis}}">
            <Rectangle Fill="{DynamicResource ScanOverlayBackground}"/>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True"
                             Width="240" Height="3"
                             Margin="0,0,0,12"
                             Foreground="{DynamicResource AccentPrimary}"/>
                <TextBlock Text="{Binding OperationProgress}"
                           Foreground="{DynamicResource ScanOverlayText}"
                           FontFamily="{StaticResource AppFont}"
                           FontSize="{StaticResource BodySize}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

    </Grid>
</Window>
