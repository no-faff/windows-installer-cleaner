<Window x:Class="SimpleWindowsInstallerCleaner.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Simple Windows installer cleaner"
        Width="700" Height="320"
        MinWidth="500" MinHeight="280"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">

    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding ScanCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Windows blue accent button -->
        <Style x:Key="MoveButton" TargetType="Button">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="20,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#106EBE"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#CCCCCC"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Inline text-link button -->
        <Style x:Key="LinkButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#0078D4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="2,0"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <TextBlock Text="{TemplateBinding Content}"
                                   Foreground="{TemplateBinding Foreground}"
                                   TextDecorations="Underline"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- reboot banner -->
            <RowDefinition Height="*"/>     <!-- main content -->
            <RowDefinition Height="Auto"/>  <!-- bottom bar -->
        </Grid.RowDefinitions>

        <!-- ── Pending reboot banner ───────────────────────────────── -->
        <Border Grid.Row="0"
                Background="#FFF3CD"
                BorderBrush="#FFEEBA"
                BorderThickness="0,0,0,1"
                Padding="12,8"
                Visibility="{Binding HasPendingReboot, Converter={StaticResource BoolToVis}}">
            <TextBlock Foreground="#856404" FontSize="12" TextWrapping="Wrap">
                ⚠  Windows has pending updates. Restart your computer before moving or deleting installer files.
            </TextBlock>
        </Border>

        <!-- ── Main content ───────────────────────────────────────── -->
        <Grid Grid.Row="1" Margin="20,18,20,14">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- summary lines -->
                <RowDefinition Height="14"/>    <!-- spacer -->
                <RowDefinition Height="Auto"/>  <!-- destination row -->
                <RowDefinition Height="12"/>    <!-- spacer -->
                <RowDefinition Height="Auto"/>  <!-- move/delete buttons -->
            </Grid.RowDefinitions>

            <!-- Summary lines -->
            <StackPanel Grid.Row="0">

                <!-- Still used -->
                <DockPanel Margin="0,0,0,7">
                    <Button DockPanel.Dock="Right"
                            Style="{StaticResource LinkButton}"
                            Content="details..."
                            Command="{Binding OpenRegisteredDetailsCommand}"
                            Margin="10,0,0,0"
                            VerticalAlignment="Center"/>
                    <TextBlock DockPanel.Dock="Right"
                               Text="{Binding RegisteredSizeDisplay}"
                               Foreground="#666" FontSize="13"
                               VerticalAlignment="Center" MinWidth="80"
                               TextAlignment="Right"/>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="●" Foreground="#666" Margin="0,0,7,0" FontSize="13"/>
                        <TextBlock Text="{Binding RegisteredFileCount}"
                                   Foreground="#333" FontWeight="SemiBold" FontSize="13"/>
                        <TextBlock Text=" files still used" Foreground="#666" FontSize="13"/>
                    </StackPanel>
                </DockPanel>

                <!-- Excluded by filters -->
                <DockPanel Margin="0,0,0,7">
                    <Button DockPanel.Dock="Right"
                            Style="{StaticResource LinkButton}"
                            Content="details..."
                            Command="{Binding OpenOrphanedDetailsCommand}"
                            Margin="10,0,0,0"
                            VerticalAlignment="Center"/>
                    <TextBlock DockPanel.Dock="Right"
                               Text="{Binding ExcludedSizeDisplay}"
                               Foreground="#666" FontSize="13"
                               VerticalAlignment="Center" MinWidth="80"
                               TextAlignment="Right"/>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center"
                                ToolTip="Excluded files match your exclusion filters (e.g. Adobe). Edit filters in Settings.">
                        <TextBlock Text="●" Foreground="#666" Margin="0,0,7,0" FontSize="13"/>
                        <TextBlock Text="{Binding ExcludedFileCount}"
                                   Foreground="#333" FontWeight="SemiBold" FontSize="13"/>
                        <TextBlock Text=" files excluded by filters" Foreground="#666" FontSize="13"/>
                    </StackPanel>
                </DockPanel>

                <!-- Orphaned -->
                <DockPanel>
                    <Button DockPanel.Dock="Right"
                            Style="{StaticResource LinkButton}"
                            Content="details..."
                            Command="{Binding OpenOrphanedDetailsCommand}"
                            Margin="10,0,0,0"
                            VerticalAlignment="Center"/>
                    <TextBlock DockPanel.Dock="Right"
                               Text="{Binding OrphanedSizeDisplay}"
                               Foreground="#C50F1F" FontSize="13"
                               VerticalAlignment="Center" MinWidth="80"
                               TextAlignment="Right"/>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="●" Foreground="#C50F1F" Margin="0,0,7,0" FontSize="13"/>
                        <TextBlock Text="{Binding OrphanedFileCount}"
                                   Foreground="#C50F1F" FontWeight="SemiBold" FontSize="13"/>
                        <TextBlock Text=" files orphaned" Foreground="#666" FontSize="13"/>
                    </StackPanel>
                </DockPanel>

            </StackPanel>

            <!-- Move destination row -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- TextBox with placeholder overlay -->
                <Grid Grid.Column="0">
                    <TextBox Text="{Binding MoveDestination, Mode=OneWay}"
                             IsReadOnly="True"
                             Padding="6,5"
                             FontSize="12"
                             VerticalContentAlignment="Center"/>
                    <TextBlock Text="Choose a destination folder..."
                               Foreground="#AAA" FontStyle="Italic" FontSize="12"
                               Padding="8,5" VerticalAlignment="Center"
                               IsHitTestVisible="False">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding MoveDestination}" Value="">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Grid>

                <Button Grid.Column="2"
                        Content="Browse..."
                        Command="{Binding BrowseDestinationCommand}"
                        Padding="12,5"
                        FontSize="12"/>
            </Grid>

            <!-- Move / Delete buttons -->
            <DockPanel Grid.Row="4">
                <Button DockPanel.Dock="Right"
                        Content="Delete"
                        Command="{Binding DeleteAllCommand}"
                        Padding="16,8"
                        FontSize="13"
                        Margin="8,0,0,0"/>

                <Button DockPanel.Dock="Left"
                        Style="{StaticResource MoveButton}"
                        Content="Move"
                        Command="{Binding MoveAllCommand}"/>

                <TextBlock DockPanel.Dock="Left"
                           Text="{Binding OperationProgress}"
                           VerticalAlignment="Center"
                           Foreground="#666" FontSize="12"
                           Margin="12,0,0,0"
                           TextTrimming="CharacterEllipsis"/>
            </DockPanel>
        </Grid>

        <!-- ── Bottom bar ──────────────────────────────────────────── -->
        <Border Grid.Row="2"
                Background="#EBEBEB"
                BorderBrush="#D0D0D0"
                BorderThickness="0,1,0,0"
                Padding="12,5">
            <DockPanel LastChildFill="False">
                <Button DockPanel.Dock="Left"
                        Style="{StaticResource LinkButton}"
                        Content="⚙ Settings"
                        Command="{Binding OpenSettingsCommand}"/>

                <Button DockPanel.Dock="Left"
                        Style="{StaticResource LinkButton}"
                        Content="↺ Refresh"
                        Command="{Binding RefreshCommand}"
                        Margin="12,0,0,0"/>

                <Button DockPanel.Dock="Left"
                        Style="{StaticResource LinkButton}"
                        Content="ℹ About"
                        Command="{Binding ShowAboutCommand}"
                        Margin="12,0,0,0"/>

                <Button DockPanel.Dock="Right"
                        Style="{StaticResource LinkButton}"
                        Content="♥ Donate"
                        Command="{Binding DonateCommand}"
                        Margin="0,0,12,0"/>

                <TextBlock DockPanel.Dock="Right"
                           Text="no-faff.github.io"
                           Foreground="#888" FontSize="11"
                           VerticalAlignment="Center"/>
            </DockPanel>
        </Border>

        <!-- ── Scanning overlay ────────────────────────────────────── -->
        <Grid Grid.Row="0" Grid.RowSpan="3"
              Visibility="{Binding IsScanning, Converter={StaticResource BoolToVis}}">
            <Rectangle Fill="#88000000"/>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="260" Height="4" Margin="0,0,0,12"/>
                <TextBlock Text="{Binding ScanProgress}"
                           Foreground="White" FontSize="13"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- ── Operating overlay ──────────────────────────────────── -->
        <Grid Grid.Row="0" Grid.RowSpan="3"
              Visibility="{Binding IsOperating, Converter={StaticResource BoolToVis}}">
            <Rectangle Fill="#88000000"/>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="260" Height="4" Margin="0,0,0,12"/>
                <TextBlock Text="{Binding OperationProgress}"
                           Foreground="White" FontSize="13"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

    </Grid>
</Window>
