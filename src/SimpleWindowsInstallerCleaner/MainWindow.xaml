<Window x:Class="SimpleWindowsInstallerCleaner.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Simple Windows installer cleaner"
        Width="900" Height="600"
        MinWidth="640" MinHeight="400"
        Background="#F3F3F3">

    <Window.Resources>
        <!-- Button style -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Padding" Value="16,6"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#E0E0E0"/>
        </Style>

        <!-- Converter: bool → Visibility -->
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>   <!-- toolbar -->
            <RowDefinition Height="*"/>      <!-- file list -->
            <RowDefinition Height="Auto"/>   <!-- status bar -->
        </Grid.RowDefinitions>

        <!-- ── Toolbar ─────────────────────────────────────────────────── -->
        <Border Grid.Row="0" Background="#FFFFFF" BorderBrush="#DCDCDC" BorderThickness="0,0,0,1" Padding="12,8">
            <DockPanel>
                <TextBlock DockPanel.Dock="Left"
                           Text="Simple Windows installer cleaner"
                           FontSize="15" FontWeight="SemiBold"
                           VerticalAlignment="Center" Margin="0,0,20,0"/>

                <Button DockPanel.Dock="Right"
                        Content="Scan"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding ScanCommand}"
                        IsDefault="True"/>

                <TextBlock Text="{Binding StatusText}"
                           FontSize="12" Foreground="#555"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"/>
            </DockPanel>
        </Border>

        <!-- ── File list ─────────────────────────────────────────────── -->
        <Grid Grid.Row="1">
            <!-- Empty state -->
            <TextBlock Text="No orphaned files found yet. Click Scan to start."
                       HorizontalAlignment="Center" VerticalAlignment="Center"
                       Foreground="#888" FontSize="13">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Files.Count}" Value="0">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                        <Setter Property="Visibility" Value="Collapsed"/>
                    </Style>
                </TextBlock.Style>
            </TextBlock>

            <ListView ItemsSource="{Binding Files}"
                      SelectionMode="Extended"
                      BorderThickness="0"
                      Background="Transparent"
                      Visibility="{Binding Files.Count, Converter={StaticResource BoolToVis}}">
                <ListView.View>
                    <GridView>
                        <!-- Checkbox column -->
                        <GridViewColumn Width="36">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                              HorizontalAlignment="Center"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- File name -->
                        <GridViewColumn Header="File" Width="220">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding File.FileName}"
                                                   ToolTip="{Binding File.FullPath}"/>
                                        <!-- Adobe caution badge -->
                                        <Border Background="#FFF3CD" CornerRadius="3"
                                                Margin="6,0,0,0" Padding="4,1"
                                                Visibility="{Binding File.IsAdobeWarning, Converter={StaticResource BoolToVis}}">
                                            <TextBlock Text="Adobe — check before moving"
                                                       FontSize="10" Foreground="#856404"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Size -->
                        <GridViewColumn Header="Size" Width="90">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding File.SizeDisplay}"
                                               HorizontalAlignment="Right" Margin="0,0,8,0"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Type -->
                        <GridViewColumn Header="Type" Width="60">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value=".msi"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding File.IsPatch}" Value="True">
                                                        <Setter Property="Text" Value=".msp"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Full path (resizable) -->
                        <GridViewColumn Header="Path" Width="360">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding File.FullPath}"
                                               Foreground="#666" FontSize="11"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding File.FullPath}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>
        </Grid>

        <!-- ── Status / action bar ──────────────────────────────────── -->
        <Border Grid.Row="2" Background="#FFFFFF" BorderBrush="#DCDCDC"
                BorderThickness="0,1,0,0" Padding="12,8">
            <DockPanel>
                <!-- Move button (right) -->
                <Button DockPanel.Dock="Right"
                        Content="Move selected"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding MoveSelectedCommand}"
                        Margin="8,0,0,0"/>

                <!-- Destination folder picker -->
                <Button DockPanel.Dock="Right"
                        Content="Choose destination…"
                        Style="{StaticResource SecondaryButton}"
                        Command="{Binding ChooseDestinationCommand}"/>

                <!-- Select all / none (left) -->
                <Button DockPanel.Dock="Left"
                        Content="Select all"
                        Style="{StaticResource SecondaryButton}"
                        Command="{Binding SelectAllCommand}"
                        Margin="0,0,8,0"/>
                <Button DockPanel.Dock="Left"
                        Content="Select none"
                        Style="{StaticResource SecondaryButton}"
                        Command="{Binding SelectNoneCommand}"
                        Margin="0,0,16,0"/>

                <!-- Selected size (centre) -->
                <TextBlock Text="{Binding SelectedSizeDisplay}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Foreground="#444" FontSize="12"/>
            </DockPanel>
        </Border>

        <!-- Progress overlay -->
        <Border Grid.Row="0" Grid.RowSpan="3"
                Background="#80000000"
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="260" Height="6" Margin="0,0,0,12"/>
                <TextBlock Text="{Binding StatusText}"
                           Foreground="White" FontSize="14" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
