<Window x:Class="SimpleWindowsInstallerCleaner.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:SimpleWindowsInstallerCleaner.Controls"
        Title="Settings"
        Width="480" Height="420"
        MinWidth="350" MinHeight="310"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        WindowStyle="None"
        AllowsTransparency="False"
        Background="{DynamicResource WindowBackground}"
        FontFamily="{StaticResource AppFont}">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32"
                      ResizeBorderThickness="6"
                      GlassFrameThickness="0"
                      CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Window.InputBindings>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- title bar -->
            <RowDefinition Height="*"/>    <!-- content -->
        </Grid.RowDefinitions>

        <!-- ── Custom title bar ────────────────────────────────────── -->
        <controls:TitleBar Grid.Row="0"
                           WindowTitle="Settings"
                           ShowMinimise="False"
                           ShowMaximise="False"/>

        <!-- ── Content ───────────────────────────────────────────── -->
        <Grid Grid.Row="1" Margin="{StaticResource WindowPadding}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- section header -->
                <RowDefinition Height="10"/>
                <RowDefinition Height="Auto"/> <!-- description -->
                <RowDefinition Height="12"/>
                <RowDefinition Height="Auto"/> <!-- input row -->
                <RowDefinition Height="8"/>
                <RowDefinition Height="*"/>    <!-- filter list card -->
                <RowDefinition Height="16"/>
                <RowDefinition Height="Auto"/> <!-- pending reboot checkbox -->
                <RowDefinition Height="16"/>
                <RowDefinition Height="Auto"/> <!-- save/cancel buttons -->
            </Grid.RowDefinitions>

            <!-- ── Section header ─────────────────────────────────── -->
            <TextBlock Grid.Row="0"
                       Text="Exclusion filters"
                       Foreground="{DynamicResource TextPrimary}"
                       FontFamily="{StaticResource AppFont}"
                       FontSize="{StaticResource SubheadingSize}"
                       FontWeight="SemiBold"/>

            <!-- ── Description ────────────────────────────────────── -->
            <StackPanel Grid.Row="2">
                <TextBlock Text="Some products (notably Adobe) use non-standard patch management that makes their installer files appear orphaned when they may still be needed. Removing them can break updates and repairs."
                           TextWrapping="Wrap"
                           Foreground="{DynamicResource TextSecondary}"
                           FontFamily="{StaticResource AppFont}"
                           FontSize="{StaticResource SmallSize}"
                           Margin="0,0,0,6"/>
                <TextBlock Text="Files whose name, author, title, subject or digital signature matches these terms won't be moved or deleted."
                           TextWrapping="Wrap"
                           Foreground="{DynamicResource TextTertiary}"
                           FontFamily="{StaticResource AppFont}"
                           FontSize="{StaticResource SmallSize}"/>
            </StackPanel>

            <!-- ── Input row ──────────────────────────────────────── -->
            <Grid Grid.Row="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0"
                        BorderBrush="{DynamicResource CardBorder}"
                        BorderThickness="1"
                        CornerRadius="{StaticResource ButtonRadius}">
                    <TextBox Text="{Binding NewFilter, UpdateSourceTrigger=PropertyChanged}"
                             Foreground="{DynamicResource TextPrimary}"
                             FontFamily="{StaticResource AppFont}"
                             FontSize="{StaticResource BodySize}"
                             Padding="8,6"
                             BorderThickness="0"
                             Background="Transparent">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Return" Command="{Binding AddFilterCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>
                </Border>

                <Button Grid.Column="2"
                        Style="{DynamicResource SecondaryButton}"
                        Content="Add"
                        Command="{Binding AddFilterCommand}"/>
            </Grid>

            <!-- ── Filter list card ───────────────────────────────── -->
            <Border Grid.Row="6"
                    Background="{DynamicResource CardBackground}"
                    BorderBrush="{DynamicResource CardBorder}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource CardRadius}"
                    Effect="{DynamicResource CardShadow}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding Filters}"
                                  Padding="12,8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,3">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="{Binding}"
                                               Foreground="{DynamicResource TextPrimary}"
                                               FontFamily="{StaticResource AppFont}"
                                               FontSize="{StaticResource BodySize}"
                                               VerticalAlignment="Center"/>

                                    <Button Grid.Column="1"
                                            Content="×"
                                            Command="{Binding DataContext.RemoveFilterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            FontFamily="{StaticResource AppFont}"
                                            FontSize="14"
                                            Foreground="{DynamicResource TextTertiary}"
                                            Padding="6,2"
                                            Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border x:Name="Bg" Background="Transparent" Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="Bg" Property="Background" Value="Transparent"/>
                                                                    <Setter Property="Foreground" Value="{DynamicResource AccentDanger}"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- ── Pending reboot checkbox ────────────────────────── -->
            <CheckBox Grid.Row="8"
                      IsChecked="{Binding CheckPendingReboot}"
                      Content="Check for pending reboots before scanning"
                      Foreground="{DynamicResource TextPrimary}"
                      FontFamily="{StaticResource AppFont}"
                      FontSize="{StaticResource BodySize}"/>

            <!-- ── Save / Cancel buttons ──────────────────────────── -->
            <StackPanel Grid.Row="10"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right">
                <Button Style="{DynamicResource PrimaryButton}"
                        Content="Save"
                        Command="{Binding SaveCommand}"
                        IsDefault="True"
                        Margin="0,0,8,0"/>
                <Button Style="{DynamicResource SecondaryButton}"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
