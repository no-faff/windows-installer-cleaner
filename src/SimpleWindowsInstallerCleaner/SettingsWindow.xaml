<Window x:Class="SimpleWindowsInstallerCleaner.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings"
        Width="480" Height="480"
        MinWidth="380" MinHeight="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        Background="{StaticResource Base100}">

    <Window.InputBindings>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}"/>
    </Window.InputBindings>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- 0: heading -->
            <RowDefinition Height="8"/>     <!-- 1: gap -->
            <RowDefinition Height="Auto"/>  <!-- 2: description -->
            <RowDefinition Height="12"/>    <!-- 3: gap -->
            <RowDefinition Height="Auto"/>  <!-- 4: input + Add -->
            <RowDefinition Height="8"/>     <!-- 5: gap -->
            <RowDefinition Height="*"/>     <!-- 6: filter list -->
            <RowDefinition Height="16"/>    <!-- 7: gap -->
            <RowDefinition Height="Auto"/>  <!-- 8: OPTIONS heading -->
            <RowDefinition Height="8"/>     <!-- 9: gap -->
            <RowDefinition Height="Auto"/>  <!-- 10: checkbox -->
            <RowDefinition Height="16"/>    <!-- 11: gap -->
            <RowDefinition Height="Auto"/>  <!-- 12: buttons -->
        </Grid.RowDefinitions>

        <!-- EXCLUSION FILTERS heading -->
        <TextBlock Grid.Row="0" Text="EXCLUSION FILTERS"
                   Foreground="#94a3b8" FontSize="14"/>

        <!-- Description -->
        <StackPanel Grid.Row="2">
            <TextBlock Text="Some products (notably Adobe) use non-standard patch management that makes their installer files appear orphaned when they may still be needed. Removing them can break updates and repairs."
                       TextWrapping="Wrap" Foreground="#cbd5e1" FontSize="12" Margin="0,0,0,6"/>
            <TextBlock Text="Files whose name, author, title, subject or digital signature matches these terms won't be moved or deleted."
                       TextWrapping="Wrap" Foreground="#94a3b8" FontSize="12"/>
        </StackPanel>

        <!-- Input + Add button -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox Grid.Column="0" Style="{StaticResource PillTextBox}"
                     Text="{Binding NewFilter, UpdateSourceTrigger=PropertyChanged}">
                <TextBox.InputBindings>
                    <KeyBinding Key="Return" Command="{Binding AddFilterCommand}"/>
                </TextBox.InputBindings>
            </TextBox>

            <Button Grid.Column="2" Style="{StaticResource PrimaryPill}"
                    Content="Add" Command="{Binding AddFilterCommand}"/>
        </Grid>

        <!-- Filter list â€” plain Border, NO CardNoPad (avoids wpfui overrides) -->
        <Border Grid.Row="6" Background="#0f172a" CornerRadius="12"
                MinHeight="90">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="4">
                <ItemsControl ItemsSource="{Binding Filters}" Padding="8,4">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="{Binding}"
                                           Foreground="#f8fafc" FontSize="14" VerticalAlignment="Center"/>
                                <Button Grid.Column="1" Style="{StaticResource GhostPill}"
                                        Content="&#x00D7;" Height="28" Padding="8,0" FontSize="15"
                                        Command="{Binding DataContext.RemoveFilterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <!-- OPTIONS heading -->
        <TextBlock Grid.Row="8" Text="OPTIONS"
                   Foreground="#94a3b8" FontSize="14"/>

        <!-- Checkbox with explicit template to bypass wpfui -->
        <CheckBox Grid.Row="10"
                  IsChecked="{Binding CheckPendingReboot}"
                  Foreground="#f8fafc" FontSize="14" Cursor="Hand">
            <CheckBox.Template>
                <ControlTemplate TargetType="CheckBox">
                    <StackPanel Orientation="Horizontal">
                        <Border x:Name="Box" Width="18" Height="18" CornerRadius="3"
                                Background="#0f172a" BorderBrush="#475569" BorderThickness="1"
                                VerticalAlignment="Center" Margin="0,0,10,0">
                            <TextBlock x:Name="Check" Text="&#x2713;" Foreground="#f8fafc"
                                       FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Visibility="Collapsed"/>
                        </Border>
                        <ContentPresenter VerticalAlignment="Center"/>
                    </StackPanel>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter TargetName="Check" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="Box" Property="Background" Value="#4f46e5"/>
                            <Setter TargetName="Box" Property="BorderBrush" Value="#4f46e5"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Box" Property="BorderBrush" Value="#94a3b8"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </CheckBox.Template>
            <TextBlock Text="Check for pending reboots before scanning"
                       Foreground="#f8fafc" FontSize="14"/>
        </CheckBox>

        <!-- Save / Cancel -->
        <StackPanel Grid.Row="12" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Style="{StaticResource AccentPill}" Content="Save"
                    Command="{Binding SaveCommand}" IsDefault="True" Margin="0,0,8,0"/>
            <Button Style="{StaticResource PrimaryPill}" Content="Cancel"
                    Command="{Binding CancelCommand}"/>
        </StackPanel>
    </Grid>
</Window>
